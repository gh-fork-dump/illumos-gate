.\"
.\" Sun Microsystems, Inc. gratefully acknowledges The Open Group for
.\" permission to reproduce portions of its copyrighted documentation.
.\" Original documentation from The Open Group can be obtained online at
.\" http://www.opengroup.org/bookstore/.
.\"
.\" The Institute of Electrical and Electronics Engineers and The Open
.\" Group, have given us permission to reprint portions of their
.\" documentation.
.\"
.\" In the following statement, the phrase ``this text'' refers to portions
.\" of the system documentation.
.\"
.\" Portions of this text are reprinted and reproduced in electronic form
.\" in the SunOS Reference Manual, from IEEE Std 1003.1, 2004 Edition,
.\" Standard for Information Technology -- Portable Operating System
.\" Interface (POSIX), The Open Group Base Specifications Issue 6,
.\" Copyright (C) 2001-2004 by the Institute of Electrical and Electronics
.\" Engineers, Inc and The Open Group.  In the event of any discrepancy
.\" between these versions and the original IEEE and The Open Group
.\" Standard, the original IEEE and The Open Group Standard is the referee
.\" document.  The original Standard can be obtained online at
.\" http://www.opengroup.org/unix/online.html.
.\"
.\" This notice shall appear on any product containing this material.
.\"
.\" The contents of this file are subject to the terms of the
.\" Common Development and Distribution License (the "License").
.\" You may not use this file except in compliance with the License.
.\"
.\" You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
.\" or http://www.opensolaris.org/os/licensing.
.\" See the License for the specific language governing permissions
.\" and limitations under the License.
.\"
.\" When distributing Covered Code, include this CDDL HEADER in each
.\" file and include the License file at usr/src/OPENSOLARIS.LICENSE.
.\" If applicable, add the following below this CDDL HEADER, with the
.\" fields enclosed by brackets "[]" replaced with your own identifying
.\" information: Portions Copyright [yyyy] [name of copyright owner]
.\"
.\"
.\" Copyright 1989 AT&T
.\" Portions Copyright (c) 1992, X/Open Company Limited  All Rights Reserved
.\" Copyright (c) 1999, Sun Microsystems, Inc.  All Rights Reserved.
.\"
.Dd May 19, 1999
.Dt MSGRCV 2
.Os
.Sh NAME
.Nm msgrcv
.Nd message receive operation
.Sh SYNOPSIS
.In sys/msg.h
.Ft ssize_t
.Fo msgrcv
.Fa "int msqid"
.Fa "void *msgp"
.Fa "size_t msgsz"
.Fa "long int msgtyp"
.Fa "int msgflg"
.Fc
.Sh DESCRIPTION
The
.Fn msgrcv
function reads a message from the queue associated with the
message queue identifier specified by
.Fa msqid
and places it in the user-defined buffer pointed to by
.Fa msgp .
.Pp
The
.Fa msgp
argument points to a user-defined buffer that must contain first
a field of type
.Vt "long int"
that will specify the type of the message, and then a data portion that will
hold the data bytes of the message.
The structure below is an example of what this user-defined buffer might look
like:
.Bd -literal -offset indent
struct mymsg {
        long int    mtype;     /* message type */
        char        mtext[1];  /* message text */
}
.Ed
.Pp
The
.Va mtype
member is the received message's type as specified by the sending process.
.Pp
The
.Va mtext
member is the text of the message.
.Pp
The
.Fa msgsz
argument specifies the size in bytes of
.Va mtext .
The
received message is truncated to
.Fa msgsz
bytes if it is larger than
.Fa msgsz
and
.Ql Pq msgflg & MSG_NOERROR
is non-zero.
The truncated part of the message is lost and no indication of the truncation
is given to the calling process.
The
.Fa msgtyp
argument specifies the type of message requested as follows:
.Bl -dash -width Ds
.It
If
.Fa msgtyp
is 0, the first message on the queue is received.
.It
If
.Fa msgtyp
is greater than 0, the first message of type
.Fa msgtyp
is received.
.It
If
.Fa msgtyp
is less than 0, the first message of the lowest type that is less than or equal
to the absolute value of
.Fa msgtyp
is received.
.El
.Pp
The
.Fa msgflg
argument specifies which of the following actions is to be
taken if a message of the desired type is not on the queue:
.Bl -dash -width Ds
.It
If
.Ql Pq msgflg & IPC_NOWAIT
is non-zero, the calling process will return immediately with a return value of
-1 and
.Va errno
set to
.Er ENOMSG .
.It
If
.Ql Pq msgflg & IPC_NOWAIT
is 0, the calling process will suspend execution until one of the following
occurs:
.Bl -dash -width Ds
.It
A message of the desired type is placed on the queue.
.It
The message queue identifier
.Fa msqid
is removed from the system
.Pq see Xr msgctl 2 ;
when this occurs,
.Va errno
is set equal to
.Er EIDRM
and -1 is returned.
.It
The calling process receives a signal that is to be caught; in this case a
message is not received and the calling process resumes execution in the manner
prescribed in
.Xr sigaction 2 .
.El
.El
.Pp
Upon successful completion, the following actions are taken with respect to the
data structure associated with
.Fa msqid Pq see Xr Intro 2 :
.Pp
.Bl -dash -compact
.It
.Va msg_qnum
is decremented by 1.
.It
.Va g_lrpid
is set equal to the process ID of the calling process.
.It
.Va msg_rtime
is set equal to the current time.
.El
.Sh RETURN VALUES
Upon successful completion,
.Fn msgrcv
returns a value equal to the number
of bytes actually placed into the buffer
.Va mtext ;
otherwise the value -1 is returned, no message is received
and the global variable
.Va errno
is set to indicate the error.
.Sh ERRORS
The
.Fn msgrcv
function will fail if:
.Bl -tag -width Er
.It Bq Er E2BIG
The value of mtext is greater than
.Fa msgsz
and
.Ql Pq msgflg\ &\ MSG_NOERROR
is 0.
.It Bq Er EACCES
Operation permission is denied to the calling process.
See
.Xr Intro 2 .
.It Bq Er EIDRM
The message queue identifier
.Fa msqid
is removed from the system.
.It Bq Er EINTR
The
.Fn msgrcv
function was interrupted by a signal.
.It Bq Er EINVAL
The
.Fa msqid
argument is not a valid message queue identifier.
.It Bq Er ENOMSG
The queue does not contain a message of the desired type and
.Ql Pq msgflg\ &\ IPC_NOWAIT
is non-zero.
.El
.Pp
The
.Fn msgrcv
function may fail if:
.Bl -tag -width Er
.It Bq Er EFAULT
The
.Fa msgp
argument points to an illegal address.
.El
.Sh USAGE
The value passed as the
.Fa msgp
argument should be converted to type
.Vt void * .
.Sh INTERFACE STABILITY
.Sy Standard
.Sh SEE ALSO
.Xr Intro 2 ,
.Xr msgctl 2 ,
.Xr msgget 2 ,
.Xr msgsnd 2 ,
.Xr sigaction 2 ,
.Xr attributes 5 ,
.Xr standards 5
