.\"
.\" The contents of this file are subject to the terms of the
.\" Common Development and Distribution License (the "License").
.\" You may not use this file except in compliance with the License.
.\"
.\" You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
.\" or http://www.opensolaris.org/os/licensing.
.\" See the License for the specific language governing permissions
.\" and limitations under the License.
.\"
.\" When distributing Covered Code, include this CDDL HEADER in each
.\" file and include the License file at usr/src/OPENSOLARIS.LICENSE.
.\" If applicable, add the following below this CDDL HEADER, with the
.\" fields enclosed by brackets "[]" replaced with your own identifying
.\" information: Portions Copyright [yyyy] [name of copyright owner]
.\"
.\"
.\" Copyright 1989 AT&T
.\" Copyright (c) 2006, Sun Microsystems, Inc. All Rights Reserved
.\"
.Dd August 14, 2006
.Dt SHMGET 2
.Os
.Sh NAME
.Nm shmget
.Nd get shared memory segment identifier
.Sh SYNOPSIS
.In sys/types.h
.In sys/ipc.h
.In sys/shm.h
.Ft int
.Fn shmget "key_t key" "size_t size" "int shmflg"
.Sh DESCRIPTION
The
.Fn shmget
function returns the shared memory identifier associated with
.Fa key .
.Pp
A shared memory identifier and associated data structure and shared memory
segment of at least
.Fa size
bytes
.Pq see Xr Intro 2
are created for key if one of the following are true:
.Bl -dash -width Ds
.It
The key argument is equal to
.Dv IPC_PRIVATE .
.It
The key argument does not already have a shared memory identifier associated
with it, and
.Pq Fa shmflg No & Dv IPC_CREAT
is true.
.El
.Pp
Upon creation, the data structure associated with the new shared memory
identifier is initialized as follows:
.Bl -dash -width Ds
.It
The values of
.Va shm_perm.cuid , shm_perm.uid , shm_perm.cgid
and
.Va shm_perm.gid
are set equal to the effective user ID and effective group ID, respectively, of
the calling process.
.It
The access permission bits of
.Va shm_perm.mode
are set equal to the access
permission bits o
.Fa shmflg . Va shm_segsz
is set equal to the value of size.
.It
The values of
.Va shm_lpid , shm_nattch , shm_atime
and
.Va shm_dtime
are set equal to 0.
.It
The
.Va shm_ctime
is set equal to the current time.
.El
.Pp
Shared memory segments must be explicitly removed after the last reference to
them has been removed.
.Sh RETURN VALUES
Upon successful completion, a non-negative integer representing a shared memory
identifier is returned; otherwise the value -1 is returned and the global
variable
.Va errno
is set to indicate the error.
.Sh ERRORS
The
.Fn shmget
function will fail if:
.Bl -tag -width Er
.It Bq Er EACCES
A shared memory identifier exists for
.Fa key
but operation permission
.Pq see Xr Intro 2
as specified by the low-order 9 bits of
.Fa shmflg
would not be granted.
.It Bq Er EEXIST
A shared memory identifier exists for key but both
.Pq Fa shmflg No & Dv IPC_CREAT
and
.Pq Fa shmflg No & Dv IPC_EXCL
are true.
.It Bq Er EINVAL
The
.Fa size
argument is less than the system-imposed minimum or greater than the
system-imposed maximum.
See
.Sx NOTES .
.Pp
A shared memory identifier exists for
.Fa key
but the size of the segment associated with it is less than
.Fa size
and
.Fa size
is not equal to 0.
.It Bq Er ENOENT
A shared memory identifier does not exist for
.Fa key
and
.Pq Fa shmflg No & Dv IPC_CREAT
is false.
.It Bq Er ENOMEM
A shared memory identifier and associated shared memory segment are to be
created but the amount of available memory is not sufficient to fill the
request.
.It Bq Er ENOSPC
A shared memory identifier is to be created but the system-imposed limit on the
maximum number of allowed shared memory identifiers system-wide would be
exceeded.
See
.Sx NOTES .
.El
.Sh INTERFACE STABILITY
.Sy Standard
.Sh SEE ALSO
.Xr rctladm 1M ,
.Xr Intro 2 ,
.Xr setrctl 2 ,
.Xr shmctl 2 ,
.Xr shmop 2 ,
.Xr ftok 3C ,
.Xr getpagesize 3C ,
.Xr attributes 5 ,
.Xr standards 5
.Sh NOTES
The
.Va project.max-shm-memory
resource control restricts the total amount of shared memory a project can
allocate.
The
.Va zone.max-shm-memory
resource control restricts the total amount of shared memory that can be
allocated by a zone.
The system-imposed maximum on the size of a shared memory segment is therefore
a function of the sizes of any other shared memory segments the calling project
might have allocated that are still in use, as well as any other shared memory
segments allocated and still in use by processes in the zone.
For accounting purposes, segment sizes are rounded up to the nearest multiple
of the system page size.
See
.Xr getpagesize 3C .
.Pp
The system-imposed limit on the number of shared memory identifiers is
maintained on a per-project basis using the
.Va project.max-shm-ids
resource control.
The
.Va zone.max-shm-ids
resource control restricts the total number
of shared memory identifiers that can be allocated by a zone.
.Pp
See
.Xr rctladm 1M
and
.Xr setrctl 2
for information about using resource controls.
