.\"  Copyright 1989 AT&T  Copyright (c) 1980 Regents of the University of California.  All rights reserved.  The Berkeley software License Agreement  specifies the terms and conditions for redistribution.   Copyright (c) 2003, Sun Microsystems, Inc.  All Rights Reserved
.Dd January 20, 2003
.Dt ADJTIME 2
.Os
.Sh NAME
.Nm adjtime
.Nd correct the time to allow synchronization of the system clock
.Sh SYNOPSIS
.In sys/time.h
.Ft int
.Fn adjtime "struct timeval *delta" "struct timeval *olddelta"
.Sh DESCRIPTION
The
.Fn adjtime
function adjusts the system's notion of the current time as
returned by
.Xr gettimeofday 3C ,
advancing or retarding it by the amount of
time specified in the
.Vt "struct timeval"
pointed to by
.Fa delta .
.Pp
The adjustment is effected by speeding up (if that amount of time is positive)
or slowing down (if that amount of time is negative) the system's clock by some
small percentage, generally a fraction of one percent.
The time is always a monotonically increasing function.
A time correction from an earlier call to
.Fn adjtime
may not be finished when
.Fn adjtime
is called again.
.Pp
If
.Fa delta
is 0, then
.Fa olddelta
returns the status of the effects of the previous
.Fn adjtime
call with no effect on the time correction as a result of this call.
If
.Fa olddelta
is not a null pointer, then the structure it points to will contain, upon
successful return, the number of seconds and/or microseconds still to be
corrected from the earlier call.
If
.Fa olddelta
is a null pointer, the corresponding information will not be returned.
.Pp
This call may be used in time servers that synchronize the clocks of computers
in a local area network.
Such time servers would slow down the clocks of some machines and speed up the
clocks of others to bring them to the average network time.
.Pp
Only a processes with appropriate privileges can adjust the time of day.
.Pp
The adjustment value will be silently rounded to the resolution of the system
clock.
.Sh RETURN VALUES
.Rv -std adjtime
.Sh ERRORS
The
.Fn adjtime
function will fail if:
.Bl -tag -width Er
.It Bq Er EFAULT
The
.Fa delta
or
.Fa olddelta
argument points outside the process's allocated address space, or
.Fa olddelta
points to a region of the process's allocated address space that is not
writable.
.It Bq Er EINVAL
The
.Va tv_usec
member of
.Fa delta
is not within valid range
.Pq \(mi1000000 , 1000000 .
.It Bq Er EPERM
The
.Brq Dv PRIV_SYS_TIME
privilege is not asserted in the effective set of the calling process.
.El
.Pp
Additionally, the
.Fn adjtime
function will fail for 32-bit interfaces if:
.Bl -tag -width Er
.It Bq Er EOVERFLOW
The size of the
.Va tv_sec
member of the
.Vt timeval
structure pointed to by
.Fa olddelta
is too small to contain the correct number of seconds.
.El
.Sh SEE ALSO
.Xr date 1 ,
.Xr gettimeofday 3C ,
.Xr privileges 5
