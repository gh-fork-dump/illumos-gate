.\"  Copyright 1989 AT&T.  Copyright (c) 2003, Sun Microsystems, Inc.  All Rights Reserved
.\" The contents of this file are subject to the terms of the Common Development and Distribution License (the "License").  You may not use this file except in compliance with the License.
.\" You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE or http://www.opensolaris.org/os/licensing.  See the License for the specific language governing permissions and limitations under the License.
.\" When distributing Covered Code, include this CDDL HEADER in each file and include the License file at usr/src/OPENSOLARIS.LICENSE.  If applicable, add the following below this CDDL HEADER, with the fields enclosed by brackets "[]" replaced with your own identifying information: Portions Copyright [yyyy] [name of copyright owner]
.\"
.\" The contents of this file are subject to the terms of the
.\" Common Development and Distribution License (the "License").
.\" You may not use this file except in compliance with the License.
.\"
.\" You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
.\" or http://www.opensolaris.org/os/licensing.
.\" See the License for the specific language governing permissions
.\" and limitations under the License.
.\"
.\" When distributing Covered Code, include this CDDL HEADER in each
.\" file and include the License file at usr/src/OPENSOLARIS.LICENSE.
.\" If applicable, add the following below this CDDL HEADER, with the
.\" fields enclosed by brackets "[]" replaced with your own identifying
.\" information: Portions Copyright [yyyy] [name of copyright owner]
.\"
.\"
.\" Copyright 1989 AT&T
.\" Copyright (c) 2003, Sun Microsystems, Inc. All Rights Reserved
.\"
.Dd January 20, 2003
.Dt CHROOT 2
.Os
.Sh NAME
.Nm chroot, fchroot
.Nd change root directory
.Sh SYNOPSIS
.In unistd.h
.Ft int
.Fn chroot "const char *path"
.Ft int
.Fn fchroot "int fildes"
.Sh DESCRIPTION
The
.Fn chroot
and
.Fn fchroot
functions cause a directory to become the root directory, the starting point
for path searches for path names beginning with
.Pa / Pq slash .
The user's working directory is unaffected by
the
.Fn chroot
and
.Fn fchroot
functions.
.Pp
The
.Fa path
argument points to a path name naming a directory.
The
.Fa fildes
argument to
.Fa fchroot
is the open file descriptor of the directory which is to become the root.
.Pp
The privilege
.Brq Dv PRIV_PROC_CHROOT
must be asserted in the effective set of the process to change the root
directory.
While it is always possible to change to the system root using the
.Fn fchroot
function, it is not guaranteed to succeed in any other case, even if
.Fa fildes
is valid in all respects.
.Pp
The
.Dq Pa \&..
entry in the root directory is interpreted to mean the root directory itself.
Therefore,
.Dq Pa \&..
cannot be used to access files outside the subtree rooted at the root
directory.
Instead,
.Fn fchroot
can be used to reset the root to a directory that was opened before the root
directory was changed.
.Sh RETURN VALUES
.Rv -std
.Sh ERRORS
The
.Fn chroot
and
.Fn fchroot
functions will fail if:
.Bl -tag -width Er
.It Bq Er EACCES
Search permission is denied for a component of the path prefix of
.Fa dirname ,
or search permission is denied for the directory referred to by
.Fa dirname .
.It Bq Er EBADF
The descriptor is not valid.
.It Bq Er EFAULT
The
.Fa path
argument points to an illegal address.
.It Bq Er EINVAL
The
.Fn fchroot
function attempted to change to a directory the is not the system root and
external circumstances do not allow this.
.It Bq Er EINTR
A signal was caught during the execution of the
.Fn chroot
function.
.It Bq Er EIO
An I/O error occurred while reading from or writing to the file system.
.It Bq Er ELOOP
Too many symbolic links were encountered in translating
.Fa path .
.It Bq Er ENAMETOOLONG
The length of the  path  argument exceeds
.Dv PATH_MAX ,
or the length of a
.Fa path
component exceeds
.Dv NAME_MAX
while
.Dv _POSIX_NO_TRUNC
is in effect.
.It Bq Er ENOENT
The named directory does not exist or is a null pathname.
.It Bq Er ENOLINK
The
.Fa path
argument points to a remote machine and the link to that machine is no longer
active.
.It Bq Er ENOTDIR
Any component of the path name is not a directory.
.It Bq Er EPERM
The
.Brq Dv PRIV_PROC_CHROOT
privilege is not asserted in the effective set of the calling process.
.El
.Sh SEE ALSO
.Xr chroot 1M ,
.Xr chdir 2 ,
.Xr privileges 5
.Sh WARNINGS
The only use of
.Fn fchroot
that is appropriate is to change back to the system root.
