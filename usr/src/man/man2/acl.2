.\"
.\" The contents of this file are subject to the terms of the
.\" Common Development and Distribution License (the "License").
.\" You may not use this file except in compliance with the License.
.\"
.\" You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
.\" or http://www.opensolaris.org/os/licensing.
.\" See the License for the specific language governing permissions
.\" and limitations under the License.
.\"
.\" When distributing Covered Code, include this CDDL HEADER in each
.\" file and include the License file at usr/src/OPENSOLARIS.LICENSE.
.\" If applicable, add the following below this CDDL HEADER, with the
.\" fields enclosed by brackets "[]" replaced with your own identifying
.\" information: Portions Copyright [yyyy] [name of copyright owner]
.\"
.\"
.\" Copyright (c) 2007, Sun Microsystems, Inc. All Rights Reserved
.\"
.Dd January 10, 2007
.Dt ACL 2
.Os
.Sh NAME
.Nm acl , facl
.Nd get or set a file's Access Control List (ACL)
.Sh SYNOPSIS
.In sys/acl.h
.Ft int
.Fo acl
.Fa "char *pathp"
.Fa "int cmd"
.Fa "int nentries"
.Fa "void *aclbufp"
.Fc
.Ft int
.Fo facl
.Fa "int fildes"
.Fa "int cmd"
.Fa "int nentries"
.Fa "void *aclbufp"
.Fc
.Sh DESCRIPTION
The
.Fn acl
and
.Fn facl
functions get or set the ACL of a file
whose name is given by
.Fa pathp
or referenced by the open file descriptor
.Fa fildes .
The
.Fa nentries
argument specifies how many ACL entries fit into buffer
.Fa aclbufp .
The
.Fn acl
function is used to manipulate ACL on file system objects.
.Pp
The following types are supported for
.Fa aclbufp :
.Bl -tag -width "aclent_t"
.It Vt aclent_t
Used by the UFS file system.
.It Vt ace_t
Used by the ZFS and NFSv4 file systems.
.El
.Pp
The following values for
.Fa cmd
are supported:
.Bl -tag -width "ACE_GETACLCNT"
.It Dv SETACL
.Fa nentries Vt aclent_t
ACL entries, specified in buffer
.Fa aclbufp ,
are stored in the file's ACL.
All directories in the path name must be searchable.
.It Dv GETACL
Buffer aclbufp is filled with the file's
.Vt aclent_t
ACL entries.
Read access to the file is not required,
but all directories in the path name must be searchable.
.It Dv GETACLCNT
The number of entries in the file's
.Vt aclent_t
ACL is returned.
Read access to the file is not required, but all directories in the path name
must be searchable.
.It Dv ACE_SETACL
.Fa nentries Vt ace_t
ACL entries, specified in buffer
.Fa aclbufp ,
are stored in the file's ACL.
All directories in the path name must be searchable.
Write ACL access is required to change the file's ACL.
.It Dv ACE_GETACL
Buffer
.Fa aclbufp
is filled with the file's
.Vt ace_t
ACL entries.
Read access to the file is required and all directories in the path name must be
searchable.
.It Dv ACE_GETACLCNT
The number of entries in the file's
.Vt ace_t
ACL is returned.
Read access to the file is required and all directories in the path name must be
searchable.
.El
.Sh RETURN VALUES
Upon successful completion,
.Fn acl
and
.Fn facl
return 0 if
cmd is
.Dv SETACL
or
.Dv ACE_SETACL .
If
.Fa cmd
is
.Dv GETACL , GETACLCNT , ACE_GETACL
or
.Dv ACE_GETACLCNT
the number of ACL entries is returned.
Otherwise the value -1  is returned and the global variable
.Va errno
is set to indicate the error.
.Sh ERRORS
The
.Fn acl
function will fail if:
.Bl -tag -width Er
.It Bq Er EACCES
The caller does not have access to a component of the pathname.
.It Bq Er EFAULT
The
.Fa pathp
or
.Fa aclbufp
argument points to an illegal address.
.It Bq Er EINVAL
The
.Fa cmd
argument is not
.Dv GETACL , SETACL , ACE_GETACL , GETACLCNT
or
.Dv ACE_GETACLCNT ;
the
.Fa cmd
argument is
.Dv SETACL
and
.Fa nentries
is less than 3; or the
.Fa cmd
argument is
.Dv SETACL
or
.Dv ACE_SETACL
and the ACL specified in
.Fa aclbufp
is not valid.
.It Bq Er EIO
A disk I/O error has occurred while storing or retrieving the ACL.
.It Bq Er ENOENT
A component of the path does not exist.
.It Bq Er ENOSPC
The cmd argument is
.Dv GETACL
and
.Fa nentries
is less than the number of entries in the file's ACL, or the
.Fa cmd
argument is
.Dv SETACL
and there is insufficient space in the file system to store the ACL.
.It Bq Er ENOSYS
The
.Fa cmd
argument is
.Dv SETACL
or
.Dv ACE_SETACL
and the file specified by
.Fa pathp
resides on a file system that does not support ACLs, or the
.Fn acl
function is not supported by this implementation.
.It Bq Er ENOTDIR
A component of the path specified by
.Fa pathp
is not a directory, or the
.Fa cmd
argument is
.Dv SETACL
or
.Dv ACE_SETACL
and an attempt is made to set a default ACL on a file type other than a
directory.
.It Bq Er ENOTSUP
The
.Fa cmd
argument is
.Dv GETACL ,
but the ACL is composed of
.Vt ace_t
entries, and the ACL cannot be translated into
.Vt aclent_t
form.
.Pp
The
.Fa cmd
argument is
.Dv ACE_SETACL ,
but the underlying filesystem only supports ACLs composed of
.Vt aclent_t
entries and the ACL could not be translated into
.Vt aclent_t
form.
.It Bq Er EPERM
The effective user ID does not match the owner of the file and the
process does not have appropriate privilege.
.It Bq Er EROFS
The
.Fa cmd
argument is
.Dv SETACL
or
.Dv ACE_SETACL
and the file specified by
.Fa pathp
resides on a file system that is mounted read-only.
.El
.Sh INTERFACE STABILITY
.Sy Evolving
.Sh SEE ALSO
.Xr getfacl 1 ,
.Xr setfacl 1 ,
.Xr aclcheck 3SEC ,
.Xr aclsort 3SEC
